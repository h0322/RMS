@model HH.RMS.Model.AccountListModel
@using HH.RMS.Common.Constant
@{
    ViewBag.Title = "账户管理";
}
@section Heads{

    }
@section Scripts{
    <script type="text/javascript">
        $(function () {
            ClearSearchCookie();
            $('#accountList').datagrid({
                title: '账号列表',
                iconCls: 'icon-save',//图标  
                width: 700,
                height: 'auto',
                nowrap: false,
                striped: true,
                border: true,
                collapsible: true,//是否可折叠的  
                fit: true,//自动大小  
                url: '/Account/QueryAccountToGrid',
                idField: 'rows.accountId',
                singleSelect: false,//是否单选  
                loadMsg: "正在加载，请稍等...",
                pagination: true,//分页控件  
                rownumbers: true,//行号  
                pagination: true,//分页控件 
                pageSize: 10,        //设置默认分页大小
                pageList: [5, 10,20, 50],   //设置分页大小
                checkbox: true,
                columns: [[
                    //<th data-options="field:'ck',checkbox:true"></th>
                    { field: 'accountId', checkbox: true },
                    {
                        field: 'accountName', title: '用户名', width: 120, align: 'center'
                    },
                    { field: 'score', title: '积分', width: 120, align: 'center' },
                    { field: 'level', title: '等级', width: 120, align: 'center' },
                    {
                        field: 'person.name', title: '姓名', width: 120, align: 'center', formatter: function (value, row) {
                            return row.person.name;
                        }
                    },
                    {
                        field: 'person.nickName', title: '昵称', width: 120, align: 'center', formatter: function (value, row) {
                            return row.person.nickName;
                        }
                    },
                    {
                        field: 'createTime', title: '创建日期', width: 120, align: 'center', formatter: function (value, row) {
                            return DataGridDateTime(value,"yyyy-MM-dd")
                        }
                    },
                    {
                        field: 'edit', title: '操作', width: 100, align: 'center', formatter: function (value, row) {
                            return "<a style='color:blue;cursor:pointer' onclick='javascript:edit(" + row.accountId + ")'>编辑</a>";
                        }
                    }
                ]] ,
                toolbar:'#toolbar' 
            });
        });

        function edit(accountId)
        {
            //var row = $('#accountList').datagrid('getSelected');
            $("#accountList").datagrid('uncheckAll');
            $(".panel-title panel-with-icon").text("修改账户信息");
            $.post("/Account/QueryAccountById", { id: accountId }, function (d) {
                $('#accountId').val(d.accountId);
                $('#accountName').textbox('setValue', d.accountName);
                $('#score').numberbox('setValue', d.score);
                $('#amount').numberbox('setValue', d.amount);
                $('#level').combobox('setValue', d.level);
                $('#statusType').combobox('setValue', d.statusType);
                $('#dlgAdd').dialog('open');
                $('#accountName').textbox('disable');
            }, "json")
            
        }
        function Save()
        {
            var data = $("#from_account").serialize();
            var accountId = $("#accountId").val();
            var url = "";
            if (accountId > 0) {
                url = "/Account/UpdateAccount";
            }
            else {
                url = "/Account/SaveAccount";
            }
            $.post(url, data, function (d) {
                if (d.result == "@((int)ResultType.Success)") {
                    alert("保存成功")
                }
                else {
                    alert("保存失败")
                }

            })
        }

        function del()
        {
            var rows = $('#accountList').datagrid('getSelections')
            var accountIds = "";
            for (index in rows)
            {
                console.log(rows[index].accountId)
                accountIds += rows[index].accountId + ",";
            }
            console.log(accountIds)
            accountIds = accountIds.substring(0, accountIds.length - 1);
            $.post("/Account/DeleteAccountById", { ids: accountIds }, function (data) {
                $("#accountList").datagrid();
                alert("删除成功");
            },"json")
        }
        function cancel()
        {
            $('#dlgAdd').dialog('close');
        }
        $("#btn_search").click(function () {
            var search = $("#txt_search").val();
            var status = $("#sel_status").combobox('getValue');
            var dateFrom = $("#date_from").datebox('getValue');
            var dateTo = $("#date_to").datebox('getValue');
            if (search!="")
                $.cookie("searchText", search, { path: "/" });
            else
                $.cookie("searchText", null, { path: "/" });
            if (status!="")
                $.cookie("searchStatus", status, { path: "/" });
            else
                $.cookie("searchStatus", null, { path: "/" });
            if (dateFrom!="")
                $.cookie("searchDateFrom", dateFrom, { path: "/" });
            else
                $.cookie("searchDateFrom", null, { path: "/" });
            if (dateTo!="")
                $.cookie("searchDateTo", dateTo, { path: "/" });
            else
                $.cookie("searchDateTo", null, { path: "/" });
            $("#accountList").datagrid();
        })

    </script>
    }
<div style="width:100%; height:400px;">
    <table class="easyui-datagrid" id="accountList" style="width:600px; height:200px;"></table>
</div>

<div id="dlgAdd" class="easyui-dialog" title="添加账户" closed="true" style="width:300px" data-options=" iconCls: 'icon-save',	buttons: [{	text:'保存',	iconCls:'icon-ok',	handler:Save},{text:'取消',iconCls:'icon-cancel',handler:cancel}]">
    <div title="Register" style="width:98%;">
        <form id="from_account">
            <input type="hidden" name="accountId" id="accountId" />
            <ul><li style="width:30%">账户名称:</li><li style="width:60%"><input id="accountName" name="accountName" class="easyui-textbox"></li></ul>@*data-options="prompt:'Enter a email address...',validType:'email'"*@
            <ul><li style="width:30%">积分:</li><li style="width:60%"><input id="score" name="score" class="easyui-numberbox"></li></ul>
            <ul><li style="width:30%">充值:</li><li style="width:60%"><input id="amount" name="amount" class="easyui-numberbox"></li></ul>
            <ul>
                <li style="width:30%">等级:</li>
                <li style="width:60%">
                    <select id="level" class="easyui-combobox" name="level">
                        <option value="1">level1</option>
                        <option value="2">level2</option>
                    </select>
                </li>
            </ul>
            <ul>
                <li style="width:30%">状态:</li>
                <li style="width:60%">
                    <select id="statusType" class="easyui-combobox" name="statusType">
                        <option value="1">Normal</option>
                        <option value="2">Disable</option>
                        <option value="3">Black</option>
                    </select>
                </li>
            </ul>
        </form>
    </div>
</div>


<div id="toolbar" style="padding:5px;height:auto">
    <div><a href="#" class="easyui-linkbutton" iconcls="icon-remove" plain="true" onclick="del()">删除</a> &nbsp;
            From: <input class="easyui-datebox" style="width:80px" id="date_from">
            To: <input class="easyui-datebox" style="width:80px" id="date_to">
        状态:
        <select class="easyui-combobox" panelheight="auto" style="width:100px" id="sel_status">
            <option value="0">---请选择---</option>
            <option value="1">管理员</option>
            <option value="2">超级用户</option>
            <option value="3">普通用户</option>
        </select>
        <input class="easyui-textbox" id="txt_search" />
        <a href="#" class="easyui-linkbutton" iconcls="icon-search" id="btn_search">Search</a>
    </div>
</div>
